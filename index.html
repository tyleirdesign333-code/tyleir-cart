<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tyleir Apparel</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 420px;
      margin: auto;
      background: #000;
      color: #fff;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
    }
    header img {
      height: 45px;
    }
    .cart-icon {
      position: relative;
      font-size: 26px;
      cursor: pointer;
    }
    .cart-count {
      position: absolute;
      top: -6px;
      right: -10px;
      background: red;
      color: white;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 50%;
    }
    .product, .cart-item {
      border: 1px solid #333;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      background: #111;
    }
    img.product-img {
      width: 100%;
      border-radius: 6px;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #e10600;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 8px;
    }
    .remove {
      background: #666;
    }
    .quantity-buttons {
      display: flex;
      gap: 6px;
      margin-top: 6px;
    }
    h2 { text-align: center; }
  </style>
</head>

<body>

<header>
  <img src="https://cdn.prod.website-files.com/68f8e224973a70293bf7ebe7/68f8e614aa9b5f99ad0686b1_(1).png">
  <div class="cart-icon" onclick="toggleCart()">
    ðŸ›’ <span class="cart-count" id="cartCount">0</span>
  </div>
</header>

<h2>Products</h2>
<div id="products"></div>

<h2 id="cartTitle" style="display:none;">Cart</h2>
<ul id="cart-list"></ul>
<p id="cartTotal"></p>
<button id="checkout">Checkout All</button>

<script src="https://js.stripe.com/v3/"></script>
<script>
/* ================= STRIPE ================= */
const stripe = Stripe("pk_test_REPLACE_WITH_YOUR_REAL_TEST_KEY");
const backendUrl = "https://tyleir-backend.onrender.com";

/* ================= PRODUCTS ================= */
const products = [
  { name:"Carolina Dreams", price:4299, image:"https://stripe-camo.global.ssl.fastly.net/8165b8b520892a7816ca3bb3783854edf42883e84adaeb752960501a72c608b6" },
  { name:"Original Vintage Frayed Hoodie", price:4200, image:"https://d1wqzb5bdbcre6.cloudfront.net/d2632ca18b47feb712b76cbe939c9fdd51bd11971b215cf258ab6c2b36a47924" },
  { name:"Blue Eagle", price:4000, image:"https://d1wqzb5bdbcre6.cloudfront.net/0404c42750975880a64896795c3095ec10963bb5ba208a90e20ae9b4c4abbe51" },
  { name:"New York Sun Fade", price:3500, image:"https://stripe-camo.global.ssl.fastly.net/4b7cd92bfb097296e9dc49fdffeffe5feccc429ae11a4ec2f94d9cc02099d3d7" },
  { name:"Boxy Fleece, Pop", price:3500, image:"https://stripe-camo.global.ssl.fastly.net/d7fe635ae0a334d1c0c588cbedff5208092202b74a5c182c5b1b66ebf9dba9fb" },
  { name:"Exclusive Boxy Jacket, Spirit", price:4500, image:"https://d1wqzb5bdbcre6.cloudfront.net/583c4a1ebc7fc348d2bcc860280cbb6f419111d4403e0c78da603364b8aa4ec6" },
  { name:"Don't Touch Love", price:4200, image:"https://stripe-camo.global.ssl.fastly.net/5c9f682796e056a201bf662a8aaa08b8c698b288314a1554f6651143a8bdb390" },
  { name:"Boxy Fleece, Ohio", price:3000, image:"https://stripe-camo.global.ssl.fastly.net/7233cfb967769ba039455373b5cc51aa655cf8e0bb875e690f7cb3637931c9a3" },
  { name:"Snow-Washed Hoodie, Smile", price:4000, image:"https://d1wqzb5bdbcre6.cloudfront.net/08906a3d82c4f1425e67a5999e8a2f37027d5588189d6d1e053aece54b83bd14" },
  { name:"Zip Hoodie, Sun Fade", price:5000, image:"https://stripe-camo.global.ssl.fastly.net/c97b595c5a9c5bf3dcd11a58359ad0b226b5b56fa976c822dec7db60ad20d335" }
];

/* ================= CART ================= */
let cart = JSON.parse(localStorage.getItem("tyleirCart")) || [];

function saveCart() {
  localStorage.setItem("tyleirCart", JSON.stringify(cart));
  updateCartCount();
}

function updateCartCount() {
  document.getElementById("cartCount").innerText =
    cart.reduce((s,i)=>s+i.quantity,0);
}

function renderProducts() {
  const div = document.getElementById("products");
  div.innerHTML = "";
  products.forEach((p,i)=>{
    div.innerHTML += `
      <div class="product">
        <img class="product-img" src="${p.image}">
        <h3>${p.name}</h3>
        <p>$${(p.price/100).toFixed(2)}</p>
        <button onclick="addToCart(${i})">Add to Cart</button>
      </div>`;
  });
}

function addToCart(i) {
  const existing = cart.find(item=>item.id===i);
  if(existing) existing.quantity++;
  else cart.push({id:i, ...products[i], quantity:1});
  saveCart();
  renderCart();
}

function renderCart() {
  const ul = document.getElementById("cart-list");
  ul.innerHTML = "";
  let total = 0;
  cart.forEach((item,i)=>{
    total += item.price * item.quantity;
    ul.innerHTML += `
      <li class="cart-item">
        <strong>${item.name}</strong>
        <p>$${(item.price/100).toFixed(2)} Ã— ${item.quantity}</p>
        <div class="quantity-buttons">
          <button onclick="changeQuantity(${i},-1)">âˆ’</button>
          <button onclick="changeQuantity(${i},1)">+</button>
          <button class="remove" onclick="removeItem(${i})">Remove</button>
        </div>
      </li>`;
  });
  document.getElementById("cartTotal").innerText =
    "Total: $" + (total/100).toFixed(2);
}

function changeQuantity(i,delta){
  cart[i].quantity += delta;
  if(cart[i].quantity<1) cart.splice(i,1);
  saveCart(); renderCart();
}
function removeItem(i){
  cart.splice(i,1);
  saveCart(); renderCart();
}
function toggleCart(){
  document.getElementById("cartTitle").style.display="block";
  renderCart();
}

/* ================= CHECKOUT ================= */
document.getElementById("checkout").onclick = async ()=>{
  if(!cart.length) return alert("Cart is empty");
  const email = prompt("Enter email for checkout:");
  if(!email) return;
  const res = await fetch(`${backendUrl}/create-one-click-session`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({cart,email})
  });
  const session = await res.json();
  stripe.redirectToCheckout({sessionId:session.id});
};

/* expose functions */
window.addToCart = addToCart;
window.toggleCart = toggleCart;
window.changeQuantity = changeQuantity;
window.removeItem = removeItem;

/* init */
renderProducts();
renderCart();
updateCartCount();
</script>

</body>
</html>
